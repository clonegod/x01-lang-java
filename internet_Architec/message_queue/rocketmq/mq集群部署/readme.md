# RocketMQ Broker 的几种集群模式
#

## 单Master模式
* 一旦Broker重启或宕机时，会导致整个服务不可用，不建议生产环境使用。


## 多Master模式 / 2m-noslave 双Master模式
*	一个集群无Slave，全是Master，比如部署2个或3个Master。
*	推荐使用这种模式，性能最好。
*
* 	优点：
	* 	单个Master宕机或重启对应用无影响。
	* 	消息刷盘方式：
		- 同步刷盘可保证消息不丢失；
		- 异步刷盘可能丢失少量消息；
* 	缺点：
	* 	单台Master宕机期间，这台机器上未被消费的消息在机器恢复之前将不可订阅消费，消息的实时性会受到影响。
* 	生产实践：
	* 	通过一个监听程序实时对Master进行监控，如果发现宕机，则尝试重启该Master，并发送告警通知（短信、邮件）。


## 多Master多Slave模式 - 异步复制
*	每个Master配置1个Slave节点，集群由多对"Master-Slave"组成。
*	消息采用异步复制方式，由于是异步复制，所以主备有短暂的消息延迟。
*	优点：
	*	Master宕机后，Consumer从对应的Slave节点上进行消费，不影响消息的实时性消费。
	*	从Master宕机到切换至Slave提供消息服务，此过程不需要人工介入，对应用透明。
*	缺点：
	*	异步复制，当Master宕机时，可能会有少量消息还未复制到Slave。

## 多Master多Slave模式 - 同步双写
*	消息在Broker上的存储采用同步复制方式，同时向Master和Slave写入成功，才算成功。
*	优点：
	*	可以保证消息的实时消费
	*	可以保证消息不丢失（Master与Slave存储的消息完全一致）
*	缺点：
	*	同步双写的性能稍微差一点。